Вот документация с наглядными схемами, объясняющая, как работает ваш асинхронный калькулятор.

---

# 📖 Документация: Асинхронный калькулятор

## 🔍 **Общее описание**
Этот сервис предоставляет API для вычисления математических выражений. Запросы обрабатываются **асинхронно**, а результаты можно получить по уникальному **ID**.

## 🏛 **Архитектура системы**
Вот схема взаимодействия компонентов:

```
+------------+        +-------------+        +-----------------+        +---------------+
|  Клиент    | -----> |  API-сервер | -----> | Очередь (chan)  | -----> | Воркеры (Go)  |
+------------+        +-------------+        +-----------------+        +---------------+
        ^                     |                       |                          |
        |                     |                       v                          v
        |                     |             +-----------------+       +-----------------+
        |                     |             |   БД (Storage)  |       |  Обработчик API |
        |                     |             +-----------------+       +-----------------+
        |                     |                       |
        |                     +-----------------------+
        |                             v
        |                     +-----------------+
        |                     |  Запрос статуса |
        |                     |  или результата |
        |                     +-----------------+
        v
+------------------+
|  Ответ клиенту  |
+------------------+
```

- **Клиент** отправляет POST-запрос с выражением.
- **API-сервер** принимает запрос, сохраняет в БД и ставит в очередь.
- **Очередь (chan)** передаёт выражение воркерам для вычисления.
- **Воркеры (горутины)** вычисляют выражение и обновляют БД.
- **Клиент** может запросить результат по **ID**.

---

## 🎯 **Как работает обработка запроса**

1. **Клиент отправляет выражение**
   ```
   POST /api/v1/calculate
   {
       "expression": "5+5"
   }
   ```
    - API добавляет выражение в очередь.
    - Возвращает `{"id": 1}`.

2. **Воркеры вычисляют выражение**
    - Читают из очереди `chan`.
    - Вычисляют выражение.
    - Обновляют БД.

3. **Клиент запрашивает результат**
   ```
   GET /api/v1/expressions/1
   ```
    - Если вычисление завершено:
      ```json
      {
          "id": 1,
          "expression": "5+5",
          "status": "Ok",
          "result": 10
      }
      ```
    - Если вычисление ещё идёт:
      ```json
      {
          "id": 1,
          "expression": "5+5",
          "status": "В обработке"
      }
      ```

---

## ⚙️ **Воркеры и асинхронность**
Система использует **горутины и каналы** (`chan`) для параллельной обработки.

```go
Каждый воркер **читает из канала**, вычисляет выражение и сохраняет результат.

```

---

## 🛠 **Сценарии работы API**

### ✅ **Успешный запрос**
Запрос:
```sh
curl -X POST "http://localhost:8080/api/v1/calculate" -H "Content-Type: application/json" -d '{"expression": "10/2"}'
```
Ответ:
```json
{
    "id": 2
}
```
Запрос результата:
```sh
curl -X GET "http://localhost:8080/api/v1/expressions/2"
```
Ответ (если вычисление завершено):
```json
{
    "id": 2,
    "expression": "10/2",
    "status": "Ok",
    "result": 5
}
```

### ❌ **Ошибка в выражении**
Запрос:
```sh
curl -X POST "http://localhost:8080/api/v1/calculate" -H "Content-Type: application/json" -d '{"expression": "10/0"}'
```
Ответ:
```json
{
    "id": 3
}
```
Запрос результата:
```sh
curl -X GET "http://localhost:8080/api/v1/expressions/3"
```
Ответ (ошибка вычисления):
```json
{
    "id": 3,
    "expression": "10/0",
    "status": "Ошибка: деление на ноль"
}
```

---

## 🔥 **Заключение**
- **Асинхронный калькулятор** использует **goroutines, каналы и middleware**.
- Выражения обрабатываются в фоне.
- Можно запрашивать статус или результат вычисления.

> Автор: *philipslstwoyears*  
> 📌 *[GitHub](https://github.com/philipslstwoyears)*

---